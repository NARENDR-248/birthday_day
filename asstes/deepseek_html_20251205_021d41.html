<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üéÇ Birthday Polaroid Surprise | Interactive Celebration</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #0a0e2a;
      --bg2: #05081c;
      --card: rgba(18, 22, 48, 0.92);
      --accent1: #ff7ac4;
      --accent2: #7b5cff;
      --accent3: #ffd86f;
      --accent4: #3be8b0;
      --glass: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.15);
      --text: #ffffff;
      --text-secondary: rgba(240, 240, 255, 0.85);
      --shadow-lg: 0 30px 100px rgba(2, 6, 20, 0.8);
      --shadow-md: 0 15px 50px rgba(2, 6, 20, 0.6);
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --transition-smooth: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      --transition-fast: all 0.25s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: 'Poppins', system-ui, -apple-system, sans-serif;
      color: var(--text);
      overflow-y: auto;
      position: relative;
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
    }

    /* Video Background - Subtle effect */
    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      overflow: hidden;
      opacity: 0.4; /* Reduced opacity */
    }

    .video-background video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      object-fit: cover;
      filter: brightness(1.2) saturate(1.2); /* Increased brightness */
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(10, 14, 42, 0.4) 0%, rgba(5, 8, 28, 0.5) 100%);
      z-index: -1;
    }

    /* Loading screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: var(--bg1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .loader {
      width: 80px;
      height: 80px;
      position: relative;
      margin-bottom: 30px;
    }

    .loader-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--accent1);
      animation: spin 1.5s cubic-bezier(0.65, 0.055, 0.675, 0.19) infinite;
    }

    .loader-ring:nth-child(2) {
      border-top-color: var(--accent3);
      animation-delay: 0.3s;
    }

    .loader-ring:nth-child(3) {
      border-top-color: var(--accent2);
      animation-delay: 0.6s;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 18px;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 2px;
    }

    /* Page container */
    .container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 1s ease, transform 1s ease;
    }

    .container.visible {
      opacity: 1;
  transform: translateY(20px);
    }

    /* Main card - Brighter and more visible */
    .card {
      width: min(1200px, 98%);
      border-radius: var(--radius-lg);
      padding: 35px;
      background: rgba(25, 30, 65, 0.9);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(255, 218, 111, 0.15), transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(59, 232, 176, 0.15), transparent 40%);
      z-index: -1;
      pointer-events: none;
    }

    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3));
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 25px;
      margin-bottom: 35px;
      flex-wrap: wrap;
    }

    /* Polaroid avatar */
    .avatar-polaroid {
      width: 120px;
      padding: 15px 15px 30px;
      background: linear-gradient(145deg, #ffffff, #f5f5f5);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 20px 40px rgba(2, 6, 30, 0.8);
      transform: rotate(-8deg);
      transition: var(--transition-smooth);
      border-bottom: 45px solid #fff;
      position: relative;
      z-index: 2;
    }

    .avatar-polaroid:hover {
      transform: rotate(-3deg) translateY(-8px) scale(1.05);
      box-shadow: 0 30px 60px rgba(2, 6, 30, 0.9);
    }

    .avatar-polaroid img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      display: block;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      filter: brightness(1.05) contrast(1.05);
    }

    .avatar-caption {
      position: absolute;
      bottom: 12px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 13px;
      color: #222;
      font-weight: 700;
      letter-spacing: 0.5px;
      opacity: 0.9;
    }

    /* Title section */
    .title-section {
      flex: 1;
      min-width: 300px;
    }

    h1 {
      font-family: 'Roboto Slab', serif;
      font-size: 42px;
      margin-bottom: 10px;
      background: linear-gradient(90deg, var(--accent1), var(--accent3), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      line-height: 1.2;
      text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 17px;
      margin-bottom: 15px;
      line-height: 1.6;
      max-width: 600px;
    }

    /* Stats */
    .stats {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 18px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-width: 90px;
      backdrop-filter: blur(10px);
      transition: var(--transition-fast);
    }

    .stat-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-3px);
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent3), var(--accent1));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    /* Action buttons */
    .action-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-left: auto;
    }

    .btn {
      padding: 16px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }

    .btn:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }

    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(40, 40);
        opacity: 0;
      }
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: white;
      box-shadow: 0 10px 30px rgba(123, 92, 255, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(123, 92, 255, 0.6);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: var(--text);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    /* Layout */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 35px;
      margin-top: 25px;
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Left hero section */
    .hero-section {
      position: relative;
      border-radius: var(--radius-md);
      overflow: visible;
      height: 520px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-polaroid {
      width: 380px;
      padding: 20px 20px 55px;
      background: linear-gradient(145deg, #ffffff, #f5f5f5);
      border-radius: 14px;
      box-shadow: 0 30px 70px rgba(2, 6, 30, 0.8);
      transform: rotate(5deg);
      transition: var(--transition-smooth);
      border-bottom: 55px solid #fff;
      position: relative;
      z-index: 2;
    }

    .hero-polaroid:hover {
      transform: rotate(0deg) translateY(-15px);
      box-shadow: 0 50px 100px rgba(2, 6, 30, 0.9);
    }

    .hero-polaroid img {
      width: 100%;
      height: 360px;
      object-fit: cover;
      border-radius: 10px;
      display: block;
      transition: transform 0.8s ease;
      filter: brightness(1.05);
    }

    .hero-polaroid:hover img {
      transform: scale(1.03);
    }

    .polaroid-caption {
      position: absolute;
      bottom: 18px;
      left: 0;
      right: 0;
      text-align: center;
      font-weight: 700;
      color: #222;
      font-size: 15px;
      letter-spacing: 0.5px;
    }

    /* Polaroid corner stickers */
    .polaroid-sticker {
      position: absolute;
      width: 45px;
      height: 45px;
      background: var(--accent3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #222;
      font-weight: 700;
      font-size: 16px;
      z-index: 3;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }

    .sticker-1 {
      top: -20px;
      left: -20px;
      background: var(--accent1);
      color: white;
    }

    .sticker-2 {
      bottom: -20px;
      right: -20px;
      background: var(--accent4);
      color: #222;
    }

    /* Right panel */
    .panel {
      padding: 10px 5px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      padding: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }

    .tab {
      flex: 1;
      padding: 14px 20px;
      text-align: center;
      cursor: pointer;
      border-radius: 10px;
      font-weight: 600;
      transition: var(--transition-fast);
      color: var(--text-secondary);
    }

    .tab.active {
      background: linear-gradient(90deg, rgba(123, 92, 255, 0.4), rgba(255, 122, 196, 0.4));
      color: var(--text);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Badges */
    .badges {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }

    .badge {
      background: linear-gradient(90deg, rgba(255, 122, 196, 0.25), rgba(123, 92, 255, 0.25));
      padding: 12px 18px;
      border-radius: 50px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
      transition: var(--transition-fast);
      backdrop-filter: blur(10px);
    }

    .badge:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    /* Typewriter message */
    .typewriter-container {
      min-height: 200px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: inset 0 -8px 25px rgba(0, 0, 0, 0.2);
      padding: 25px;
      margin-bottom: 25px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .typewriter-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    #typewriter {
      white-space: pre-line;
      font-size: 17px;
      color: var(--text);
      line-height: 1.8;
      padding: 0;
      min-height: 150px;
    }

    .typewriter-cursor {
      display: inline-block;
      width: 3px;
      height: 22px;
      background: var(--accent3);
      margin-left: 2px;
      animation: blink 1s infinite;
      vertical-align: middle;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Gallery */
    .gallery-section {
      margin-top: 30px;
    }

    .gallery-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--accent3);
    }

    .gallery-title i {
      color: var(--accent1);
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 20px;
    }

    .thumb-polaroid {
      padding: 14px 14px 40px;
      background: linear-gradient(145deg, #ffffff, #f5f5f5);
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      transform: rotate(var(--rotation, -6deg));
      cursor: pointer;
      transition: var(--transition-smooth);
      border-bottom: 40px solid #fff;
      position: relative;
    }

    .thumb-polaroid:hover {
      transform: rotate(0deg) translateY(-12px) scale(1.05);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
      z-index: 3;
    }

    .thumb-polaroid img {
      width: 100%;
      height: 110px;
      object-fit: cover;
      border-radius: 8px;
      display: block;
      filter: brightness(1.05);
    }

    .thumb-caption {
      position: absolute;
      bottom: 12px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 13px;
      color: #111;
      font-weight: 700;
      opacity: 0.95;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .controls .btn {
      flex: 1;
      min-width: 150px;
    }

    /* Celebration effects */
    .confetti-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 50;
    }

    canvas#fireworks {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 49;
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(2, 2, 12, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(15px);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .lightbox.visible {
      display: flex;
      opacity: 1;
    }

    .lightbox-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
    }

    .lightbox img {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 14px;
      box-shadow: 0 50px 120px rgba(0, 0, 0, 0.9);
    }

    .lightbox-close {
      position: absolute;
      top: -20px;
      right: -20px;
      width: 45px;
      height: 45px;
      background: var(--accent1);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 22px;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      transition: var(--transition-fast);
      z-index: 101;
    }

    .lightbox-close:hover {
      background: var(--accent2);
      transform: scale(1.1) rotate(90deg);
    }

    /* Floating sparkles */
    .sparkles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
    }

    .spark {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      filter: blur(6px);
      opacity: 0;
      animation: sparkle 4s infinite;
    }

    @keyframes sparkle {
      0% {
        opacity: 0;
        transform: translateY(0) rotate(0deg);
      }
      10% {
        opacity: 0.8;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) rotate(180deg);
      }
    }

    /* Floating balloons */
    .balloon {
      position: fixed;
      bottom: -100px;
      width: 60px;
      height: 80px;
      border-radius: 50%;
      z-index: 0;
      opacity: 0.7;
      animation: floatUp 20s linear infinite;
      filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.3));
    }

    .balloon::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 50px;
      background: rgba(255, 255, 255, 0.5);
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(-100vh) rotate(20deg);
        opacity: 0;
      }
    }

    /* Progress bar */
    .progress-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 1000;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      transition: width 0.3s ease;
      border-radius: 0 2px 2px 0;
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 18px 22px;
      background: rgba(25, 30, 65, 0.95);
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--accent1);
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
      gap: 15px;
      transform: translateX(100%);
      opacity: 0;
      transition: transform 0.4s ease, opacity 0.4s ease;
      z-index: 1001;
      max-width: 380px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast i {
      font-size: 22px;
      color: var(--accent1);
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 16px;
      color: var(--text);
    }

    .toast-message {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 20px;
      padding: 0;
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
    }

    .toast-close:hover {
      color: var(--accent1);
    }

    /* Video control */
    .video-control {
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 10;
    }

    .video-control-btn {
      background: rgba(25, 30, 65, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--text);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: var(--transition-fast);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .video-control-btn:hover {
      background: rgba(35, 40, 75, 0.9);
      transform: scale(1.1);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 25px;
      }
      
      .action-buttons {
        margin-left: 0;
        width: 100%;
      }
      
      .btn {
        flex: 1;
        min-width: 0;
        padding: 14px 20px;
      }
      
      h1 {
        font-size: 32px;
      }
      
      .hero-polaroid {
        width: 320px;
      }
      
      .content-grid {
        gap: 30px;
      }
      
      .stats {
        width: 100%;
        justify-content: space-between;
      }
      
      .stat-item {
        flex: 1;
        padding: 10px 15px;
      }
      
      .toast {
        left: 20px;
        right: 20px;
        bottom: 20px;
        max-width: none;
      }
      
      .video-control {
        bottom: 20px;
        left: 20px;
      }
      
      .card {
        padding: 25px;
      }
    }

    /* Accessibility focus styles */
    button:focus-visible, 
    .tab:focus-visible,
    .thumb-polaroid:focus-visible {
      outline: 2px solid var(--accent3);
      outline-offset: 3px;
    }
  </style>
</head>
<body>
  <!-- Video Background -->
  <div class="video-background">
    <video id="bgVideo" autoplay muted loop playsinline>
      <source src="https://assets.mixkit.co/videos/preview/mixkit-colorful-confetti-falling-down-on-a-dark-background-39714-large.mp4" type="video/mp4">
      <source src="https://assets.mixkit.co/videos/preview/mixkit-confetti-falling-on-dark-background-39687-large.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div class="video-overlay"></div>
  </div>

  <!-- Loading screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loader">
      <div class="loader-ring"></div>
      <div class="loader-ring"></div>
      <div class="loader-ring"></div>
    </div>
    <div class="loading-text">LOADING BIRTHDAY SURPRISE...</div>
  </div>

  <!-- Progress bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- Sparkles -->
  <div class="sparkles" id="sparkles"></div>

  <!-- Balloons -->
  <div id="balloonsContainer"></div>

  <!-- Video Control -->
  <div class="video-control">
    <button class="video-control-btn" id="videoToggle" title="Toggle video background">
      <i class="fas fa-video"></i>
    </button>
  </div>

  <!-- Main container -->
  <div class="container" id="mainContainer">
    <div class="card">
      <div class="header">
        <div class="avatar-polaroid" id="avatarPolaroid" tabindex="0">
          <img id="avatarImg" src="https://images.unsplash.com/photo-1511367461989-f85a21fda167?q=80&w=800&auto=format&fit=crop" alt="Birthday person's avatar">
          <div class="avatar-caption">The Birthday Star! ‚ú®</div>
        </div>

        <div class="title-section">
          <h1>Happy Birthday, <span class="name" id="birthdayName">Alex</span>! üéâ</h1>
          <p class="subtitle">An interactive polaroid celebration with video backdrop ‚Äî Click "Open Surprise" to reveal personalized messages, fireworks, and memories.</p>
          
          <div class="stats">
            <div class="stat-item">
              <div class="stat-value" id="photoCount">0</div>
              <div class="stat-label">Photos</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="memoryCount">0</div>
              <div class="stat-label">Memories</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="celebrationCount">0</div>
              <div class="stat-label">Celebrations</div>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button id="openBtn" class="btn btn-primary">
            <i class="fas fa-gift"></i> Open Surprise
          </button>
          <button id="musicBtn" class="btn btn-secondary">
            <i class="fas fa-music"></i> <span id="musicText">Play Music</span>
          </button>
          <button id="helpBtn" class="btn btn-secondary" title="How to use">
            <i class="fas fa-question-circle"></i>
          </button>
        </div>
      </div>

      <div class="content-grid">
        <div class="hero-section">
          <div class="hero-polaroid" id="heroPolaroid" tabindex="0">
            <div class="polaroid-sticker sticker-1">üéÇ</div>
            <img id="heroImg" src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1400&auto=format&fit=crop" alt="Birthday celebration">
            <div class="polaroid-caption">Make a Wish & Blow the Candles! üïØÔ∏è</div>
            <div class="polaroid-sticker sticker-2">üéâ</div>
          </div>
        </div>

        <div class="panel">
          <div class="tabs">
            <div class="tab active" data-tab="message">Personal Message</div>
            <div class="tab" data-tab="gallery">Photo Gallery</div>
            <div class="tab" data-tab="wishes">Birthday Wishes</div>
          </div>

          <div class="tab-content active" id="message-tab">
            <div class="badges">
              <div class="badge"><i class="fas fa-heart"></i> Made with Love</div>
              <div class="badge"><i class="fas fa-camera"></i> Polaroid Memories</div>
              <div class="badge"><i class="fas fa-star"></i> Special Day</div>
            </div>

            <div class="typewriter-container">
              <div id="typewriter"></div>
              <span class="typewriter-cursor" id="typewriterCursor"></span>
            </div>

            <div class="controls">
              <button id="confettiBtn" class="btn btn-primary">
                <i class="fas fa-birthday-cake"></i> Confetti
              </button>
              <button id="fwBtn" class="btn btn-primary">
                <i class="fas fa-fire"></i> Fireworks
              </button>
              <button id="loveBtn" class="btn btn-secondary">
                <i class="fas fa-heart"></i> Send Love
              </button>
            </div>
          </div>

          <div class="tab-content" id="gallery-tab">
            <div class="gallery-section">
              <div class="gallery-title">
                <i class="fas fa-images"></i> Memory Lane
              </div>
              <div class="gallery" id="gallery"></div>
            </div>
          </div>

          <div class="tab-content" id="wishes-tab">
            <div class="typewriter-container">
              <h3 style="margin-bottom: 15px; color: var(--accent3);">Birthday Wishes for You!</h3>
              <ul id="wishesList" style="padding-left: 20px; line-height: 1.8;">
                <li>May your day be filled with joy and laughter!</li>
                <li>Wishing you success in all your endeavors!</li>
                <li>May all your dreams and wishes come true!</li>
                <li>Here's to another year of amazing adventures!</li>
                <li>May you be surrounded by love and happiness!</li>
                <li>Cheers to health, wealth, and happiness!</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confetti container -->
  <div id="confettiRoot" class="confetti-container"></div>

  <!-- Fireworks canvas -->
  <canvas id="fireworks"></canvas>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Image view">
    <div class="lightbox-content">
      <button class="lightbox-close" id="lightboxClose" aria-label="Close image">&times;</button>
      <img id="lightboxImg" src="" alt="">
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast">
    <i class="fas fa-bell"></i>
    <div class="toast-content">
      <div class="toast-title" id="toastTitle">Notification</div>
      <div class="toast-message" id="toastMessage">Message goes here</div>
    </div>
    <button class="toast-close" id="toastClose" aria-label="Close notification">&times;</button>
  </div>

  <!-- Audio -->
  <audio id="bgAudio" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2021/09/27/audio_2a7b1a7b6a.mp3?filename=happy-ukulele-119013.mp3"></audio>
  <audio id="confettiSound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-party-horn-sound-2927.mp3"></audio>
  <audio id="fireworkSound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-firework-show-sparkle-3060.mp3"></audio>

  <script>
    // ========== CONFIGURATION ==========
    const CONFIG = {
      birthdayName: 'Alex',
      fromName: 'Your Friends',
      avatarUrl: 'https://images.unsplash.com/photo-1511367461989-f85a21fda167?q=80&w=800&auto=format&fit=crop',
      heroUrl: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1400&auto=format&fit=crop',
      galleryImages: [
        {
          url: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=1200&auto=format&fit=crop',
          caption: 'Beautiful Memories ‚ú®'
        },
        {
          url: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1200&auto=format&fit=crop',
          caption: 'Happy Times Together üòä'
        },
        {
          url: 'https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?q=80&w=1200&auto=format&fit=crop',
          caption: 'Celebration Mode ON! üéâ'
        },
        {
          url: 'https://images.unsplash.com/photo-1492684223066-e9423ee5ff30?q=80&w=1200&auto=format&fit=crop',
          caption: 'Cake & Candles üéÇ'
        },
        {
          url: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?q=80&w=1200&auto=format&fit=crop',
          caption: 'Party Time! ü•≥'
        },
        {
          url: 'https://images.unsplash.com/photo-1531058020387-3be344556be6?q=80&w=1200&auto=format&fit=crop',
          caption: 'Special Moments üíñ'
        }
      ],
      message: `Happy Birthday, Alex! üéâ\n\nToday is all about YOU! Wishing you the most wonderful day filled with joy, laughter, and beautiful moments.\n\nMay this year bring you closer to your dreams and surround you with love and positivity.\n\nEnjoy your special day to the fullest!\n\nWith lots of love,\nYour Friends üíù`
    };

    // ========== STATE MANAGEMENT ==========
    const state = {
      isInitialized: false,
      celebrationCount: 0,
      isMusicPlaying: false,
      isTypewriterActive: false,
      currentTab: 'message',
      toastTimeout: null,
      isVideoPlaying: true
    };

    // ========== DOM ELEMENTS ==========
    const dom = {
      loadingScreen: document.getElementById('loadingScreen'),
      mainContainer: document.getElementById('mainContainer'),
      progressBar: document.getElementById('progressBar'),
      birthdayName: document.getElementById('birthdayName'),
      avatarImg: document.getElementById('avatarImg'),
      heroImg: document.getElementById('heroImg'),
      typewriter: document.getElementById('typewriter'),
      typewriterCursor: document.getElementById('typewriterCursor'),
      gallery: document.getElementById('gallery'),
      photoCount: document.getElementById('photoCount'),
      memoryCount: document.getElementById('memoryCount'),
      celebrationCount: document.getElementById('celebrationCount'),
      openBtn: document.getElementById('openBtn'),
      musicBtn: document.getElementById('musicBtn'),
      musicText: document.getElementById('musicText'),
      helpBtn: document.getElementById('helpBtn'),
      confettiBtn: document.getElementById('confettiBtn'),
      fwBtn: document.getElementById('fwBtn'),
      loveBtn: document.getElementById('loveBtn'),
      tabs: document.querySelectorAll('.tab'),
      tabContents: document.querySelectorAll('.tab-content'),
      lightbox: document.getElementById('lightbox'),
      lightboxImg: document.getElementById('lightboxImg'),
      lightboxClose: document.getElementById('lightboxClose'),
      toast: document.getElementById('toast'),
      toastTitle: document.getElementById('toastTitle'),
      toastMessage: document.getElementById('toastMessage'),
      toastClose: document.getElementById('toastClose'),
      bgAudio: document.getElementById('bgAudio'),
      confettiSound: document.getElementById('confettiSound'),
      fireworkSound: document.getElementById('fireworkSound'),
      sparkles: document.getElementById('sparkles'),
      balloonsContainer: document.getElementById('balloonsContainer'),
      bgVideo: document.getElementById('bgVideo'),
      videoToggle: document.getElementById('videoToggle')
    };

    // ========== INITIALIZATION ==========
    function init() {
      console.log("Initializing Birthday Surprise...");
      
      // Simulate loading progress
      simulateLoading();
      
      // Set config values
      dom.birthdayName.textContent = CONFIG.birthdayName;
      dom.avatarImg.src = CONFIG.avatarUrl;
      dom.heroImg.src = CONFIG.heroUrl;
      
      // Update stats
      dom.photoCount.textContent = CONFIG.galleryImages.length;
      dom.memoryCount.textContent = CONFIG.galleryImages.length + 2;
      
      // Initialize gallery
      initGallery();
      
      // Initialize sparkles
      initSparkles();
      
      // Initialize balloons
      initBalloons();
      
      // Initialize tabs
      initTabs();
      
      // Initialize fireworks
      initFireworks();
      
      // Bind events
      bindEvents();
      
      // Show welcome message after load
      setTimeout(() => {
        showToast('Welcome!', `Happy Birthday ${CONFIG.birthdayName}! Click "Open Surprise" to begin.`, 'info');
      }, 1000);
    }

    // ========== LOADING SIMULATION ==========
    function simulateLoading() {
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          
          // Hide loading screen and show main content
          setTimeout(() => {
            dom.loadingScreen.classList.add('hidden');
            dom.mainContainer.classList.add('visible');
            state.isInitialized = true;
            updateCelebrationCount(1); // Initial celebration for loading
            
            // Start subtle background animation
            startSubtleBackgroundAnimation();
          }, 500);
        }
        dom.progressBar.style.width = `${progress}%`;
      }, 150);
    }

    // ========== GALLERY INITIALIZATION ==========
    function initGallery() {
      CONFIG.galleryImages.forEach((image, index) => {
        const polaroid = document.createElement('div');
        polaroid.className = 'thumb-polaroid';
        polaroid.style.setProperty('--rotation', `${(index % 3) * 4 - 6}deg`);
        polaroid.tabIndex = 0;
        
        const img = document.createElement('img');
        img.src = image.url;
        img.alt = `Memory ${index + 1}`;
        img.loading = 'lazy';
        
        const caption = document.createElement('div');
        caption.className = 'thumb-caption';
        caption.textContent = image.caption;
        
        polaroid.appendChild(img);
        polaroid.appendChild(caption);
        
        // Add click and keyboard event
        polaroid.addEventListener('click', () => openLightbox(image.url, image.caption));
        polaroid.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openLightbox(image.url, image.caption);
          }
        });
        
        dom.gallery.appendChild(polaroid);
      });
    }

    // ========== SPARKLES EFFECT ==========
    function initSparkles() {
      for (let i = 0; i < 30; i++) {
        const spark = document.createElement('div');
        spark.className = 'spark';
        spark.style.left = `${Math.random() * 100}%`;
        spark.style.top = `${Math.random() * 100}%`;
        spark.style.animationDelay = `${Math.random() * 4}s`;
        spark.style.animationDuration = `${3 + Math.random() * 3}s`;
        spark.style.opacity = `${0.3 + Math.random() * 0.5}`;
        spark.style.width = `${4 + Math.random() * 8}px`;
        spark.style.height = spark.style.width;
        
        // Random color
        const colors = ['#ff7ac4', '#ffd86f', '#7b5cff', '#3be8b0', '#ffffff'];
        spark.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        dom.sparkles.appendChild(spark);
      }
    }

    // ========== BALLOONS EFFECT ==========
    function initBalloons() {
      const colors = ['#ff7ac4', '#ffd86f', '#7b5cff', '#3be8b0', '#ff6b6b', '#4ecdc4'];
      
      for (let i = 0; i < 10; i++) {
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.style.left = `${5 + Math.random() * 90}%`;
        balloon.style.animationDelay = `${Math.random() * 20}s`;
        balloon.style.animationDuration = `${20 + Math.random() * 20}s`;
        balloon.style.background = colors[Math.floor(Math.random() * colors.length)];
        balloon.style.width = `${50 + Math.random() * 50}px`;
        balloon.style.height = `${70 + Math.random() * 50}px`;
        balloon.style.opacity = '0.7';
        
        dom.balloonsContainer.appendChild(balloon);
      }
    }

    // ========== SUBTLE BACKGROUND ANIMATION ==========
    function startSubtleBackgroundAnimation() {
      // Create floating particles in background
      const particlesContainer = document.createElement('div');
      particlesContainer.style.cssText = 'position:fixed; inset:0; pointer-events:none; z-index:-1;';
      document.body.appendChild(particlesContainer);
      
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.style.cssText = `
          position:absolute;
          width:${2 + Math.random() * 4}px;
          height:${2 + Math.random() * 4}px;
          background:rgba(255,255,255,0.15);
          border-radius:50%;
          left:${Math.random() * 100}%;
          top:${Math.random() * 100}%;
          animation:float ${15 + Math.random() * 20}s linear infinite;
          animation-delay:${Math.random() * 10}s;
        `;
        
        // Create keyframes for floating animation
        const style = document.createElement('style');
        style.textContent = `
          @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); opacity:0; }
            10% { opacity:0.15; }
            90% { opacity:0.15; }
            100% { transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg); opacity:0; }
          }
        `;
        document.head.appendChild(style);
        
        particlesContainer.appendChild(particle);
      }
    }

    // ========== TABS SYSTEM ==========
    function initTabs() {
      dom.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          
          // Update active tab
          dom.tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Show corresponding content
          dom.tabContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === `${tabId}-tab`) {
              content.classList.add('active');
              state.currentTab = tabId;
              
              // Special actions for specific tabs
              if (tabId === 'gallery') {
                showToast('Gallery', 'Click on any polaroid to view it larger!', 'info');
              }
            }
          });
        });
      });
    }

    // ========== TYPEWRITER EFFECT ==========
    function typewriter(el, text, speed = 35, onComplete = null) {
      if (state.isTypewriterActive) return;
      
      state.isTypewriterActive = true;
      el.textContent = '';
      dom.typewriterCursor.style.display = 'inline-block';
      
      let i = 0;
      function type() {
        if (i <= text.length) {
          // Handle newlines
          if (text.charAt(i-1) === '\n') {
            el.innerHTML = text.slice(0, i).replace(/\n/g, '<br>');
          } else {
            el.textContent = text.slice(0, i);
          }
          
          i++;
          setTimeout(type, speed);
        } else {
          state.isTypewriterActive = false;
          dom.typewriterCursor.style.display = 'inline-block';
          if (onComplete) onComplete();
        }
      }
      
      type();
    }

    // ========== LIGHTBOX ==========
    function openLightbox(url, caption = '') {
      dom.lightboxImg.src = url;
      dom.lightboxImg.alt = caption;
      dom.lightbox.classList.add('visible');
      dom.lightbox.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      dom.lightbox.classList.remove('visible');
      dom.lightbox.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    // ========== TOAST NOTIFICATIONS ==========
    function showToast(title, message, type = 'info') {
      // Clear existing timeout
      if (state.toastTimeout) {
        clearTimeout(state.toastTimeout);
      }
      
      // Update toast content
      dom.toastTitle.textContent = title;
      dom.toastMessage.textContent = message;
      
      // Set icon based on type
      const icon = dom.toast.querySelector('i');
      switch(type) {
        case 'success': icon.className = 'fas fa-check-circle'; break;
        case 'error': icon.className = 'fas fa-exclamation-circle'; break;
        case 'warning': icon.className = 'fas fa-exclamation-triangle'; break;
        default: icon.className = 'fas fa-bell';
      }
      
      // Show toast
      dom.toast.classList.add('show');
      
      // Auto hide after 5 seconds
      state.toastTimeout = setTimeout(() => {
        dom.toast.classList.remove('show');
      }, 5000);
    }

    // ========== CELEBRATION COUNTER ==========
    function updateCelebrationCount(increment = 1) {
      state.celebrationCount += increment;
      dom.celebrationCount.textContent = state.celebrationCount;
      
      // Add visual feedback
      dom.celebrationCount.style.transform = 'scale(1.3)';
      setTimeout(() => {
        dom.celebrationCount.style.transform = 'scale(1)';
      }, 300);
    }

    // ========== CONFETTI EFFECT ==========
    function showConfetti(particleCount = 120) {
      // Play sound
      dom.confettiSound.currentTime = 0;
      dom.confettiSound.play().catch(e => console.log("Audio error:", e));
      
      // Update celebration count
      updateCelebrationCount();
      
      // Create confetti
      const root = document.getElementById('confettiRoot');
      const colors = ['#ff7ac4', '#ffd86f', '#7b5cff', '#3be8b0', '#fff'];
      const container = document.createElement('div');
      container.style.cssText = 'position:fixed; inset:0; pointer-events:none; z-index:50;';
      root.appendChild(container);
      
      for (let i = 0; i < particleCount; i++) {
        const el = document.createElement('div');
        const w = 10 + Math.random() * 18;
        el.style.width = w + 'px';
        el.style.height = (w * 1.4) + 'px';
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.position = 'absolute';
        el.style.left = Math.random() * 100 + '%';
        el.style.top = '-5vh';
        el.style.borderRadius = Math.random() > 0.5 ? '50%' : '4px';
        el.style.opacity = '0.9';
        el.style.transform = `rotate(${Math.random() * 360}deg)`;
        el.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        
        // Random shape
        if (Math.random() > 0.7) {
          el.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
        }
        
        container.appendChild(el);
        
        // Animate
        setTimeout(() => {
          const duration = 2.5 + Math.random() * 1.5;
          el.style.transition = `transform ${duration}s cubic-bezier(.2,.8,.2,1), top ${duration}s linear, opacity 0.5s ease`;
          el.style.top = (110 + Math.random() * 30) + 'vh';
          el.style.transform = `translateX(${(Math.random() * 200 - 100)}px) rotate(${Math.random() * 1440}deg)`;
        }, 40);
        
        // Remove
        setTimeout(() => el.style.opacity = '0', 3000);
        setTimeout(() => el.remove(), 4000);
      }
      
      // Cleanup
      setTimeout(() => container.remove(), 4500);
      
      // Show toast
      showToast('Confetti!', 'Celebrating with colorful confetti!', 'success');
    }

    // ========== FIREWORKS SYSTEM ==========
    let fireworksCanvas, fireworksCtx;
    let fireworksWidth, fireworksHeight;
    let fireworksParticles = [];
    let fireworksRockets = [];
    
    function initFireworks() {
      fireworksCanvas = document.getElementById('fireworks');
      fireworksCtx = fireworksCanvas.getContext('2d');
      
      // Set canvas size
      function resizeCanvas() {
        fireworksWidth = fireworksCanvas.width = window.innerWidth;
        fireworksHeight = fireworksCanvas.height = window.innerHeight;
      }
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      
      // Start animation loop
      animateFireworks();
    }
    
    function createFirework(x, y, color = null) {
      // Play sound
      dom.fireworkSound.currentTime = 0;
      dom.fireworkSound.play().catch(e => console.log("Audio error:", e));
      
      // Update celebration count
      updateCelebrationCount();
      
      const colors = color ? [color] : ['#ff7ac4', '#ffd86f', '#7b5cff', '#3be8b0', '#ff6b6b'];
      const explosionColor = colors[Math.floor(Math.random() * colors.length)];
      
      // Create explosion particles
      const particleCount = 70 + Math.floor(Math.random() * 50);
      for (let i = 0; i < particleCount; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = 2 + Math.random() * 10;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        const life = 1;
        const decay = 0.015 + Math.random() * 0.02;
        const size = 2 + Math.random() * 5;
        
        fireworksParticles.push({
          x, y, vx, vy,
          color: explosionColor,
          life, decay, size,
          gravity: 0.05,
          friction: 0.97
        });
      }
      
      // Show toast
      showToast('Fireworks!', 'Launching colorful fireworks!', 'success');
    }
    
    function animateFireworks() {
      // Clear with fade effect
      fireworksCtx.fillStyle = 'rgba(10, 14, 42, 0.08)';
      fireworksCtx.fillRect(0, 0, fireworksWidth, fireworksHeight);
      
      // Update and draw particles
      for (let i = fireworksParticles.length - 1; i >= 0; i--) {
        const p = fireworksParticles[i];
        
        // Apply physics
        p.vx *= p.friction;
        p.vy *= p.friction;
        p.vy += p.gravity;
        p.x += p.vx;
        p.y += p.vy;
        p.life -= p.decay;
        
        // Draw particle
        if (p.life > 0) {
          fireworksCtx.globalAlpha = p.life;
          fireworksCtx.beginPath();
          fireworksCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          fireworksCtx.fillStyle = p.color;
          fireworksCtx.fill();
          
          // Glow effect
          fireworksCtx.beginPath();
          fireworksCtx.arc(p.x, p.y, p.size * 2, 0, Math.PI * 2);
          fireworksCtx.fillStyle = p.color;
          fireworksCtx.globalAlpha = p.life * 0.3;
          fireworksCtx.fill();
        } else {
          // Remove dead particles
          fireworksParticles.splice(i, 1);
        }
      }
      
      fireworksCtx.globalAlpha = 1;
      requestAnimationFrame(animateFireworks);
    }
    
    function launchFireworks(count = 3) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const x = 100 + Math.random() * (fireworksWidth - 200);
          const y = 100 + Math.random() * (fireworksHeight / 2);
          createFirework(x, y);
        }, i * 300);
      }
    }

    // ========== VIDEO BACKGROUND CONTROL ==========
    function toggleVideoBackground() {
      if (state.isVideoPlaying) {
        dom.bgVideo.pause();
        dom.videoToggle.innerHTML = '<i class="fas fa-video-slash"></i>';
        state.isVideoPlaying = false;
        showToast('Video Paused', 'Background video paused', 'info');
      } else {
        dom.bgVideo.play();
        dom.videoToggle.innerHTML = '<i class="fas fa-video"></i>';
        state.isVideoPlaying = true;
        showToast('Video Playing', 'Background video resumed', 'info');
      }
    }

    // ========== EVENT BINDING ==========
    function bindEvents() {
      // Open surprise button
      dom.openBtn.addEventListener('click', () => {
        if (state.isTypewriterActive) return;
        
        dom.openBtn.disabled = true;
        dom.openBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Opening...';
        
        // Start the celebration
        setTimeout(() => {
          // Type the message
          typewriter(dom.typewriter, CONFIG.message, 35, () => {
            // Show confetti
            showConfetti(150);
            
            // Launch fireworks
            setTimeout(() => launchFireworks(5), 800);
            
            // Show success toast
            setTimeout(() => {
              showToast('Surprise!', 'Happy Birthday! Enjoy your special day! üéÇ', 'success');
            }, 1500);
            
            // Reset button after a delay
            setTimeout(() => {
              dom.openBtn.disabled = false;
              dom.openBtn.innerHTML = '<i class="fas fa-gift"></i> Surprise Opened!';
            }, 3000);
          });
        }, 500);
      });
      
      // Music button
      dom.musicBtn.addEventListener('click', () => {
        if (state.isMusicPlaying) {
          dom.bgAudio.pause();
          dom.musicText.textContent = 'Play Music';
          dom.musicBtn.innerHTML = '<i class="fas fa-music"></i> Play Music';
        } else {
          dom.bgAudio.play().catch(e => {
            console.log("Audio error:", e);
            showToast('Audio Error', 'Could not play audio. Click to try again.', 'error');
          });
          dom.musicText.textContent = 'Pause Music';
          dom.musicBtn.innerHTML = '<i class="fas fa-pause"></i> Pause Music';
        }
        state.isMusicPlaying = !state.isMusicPlaying;
      });
      
      // Video toggle button
      dom.videoToggle.addEventListener('click', toggleVideoBackground);
      
      // Help button
      dom.helpBtn.addEventListener('click', () => {
        showToast('How to Use', 'Click polaroids to enlarge ‚Ä¢ Tabs switch sections ‚Ä¢ Buttons trigger effects ‚Ä¢ Toggle video with bottom-left button', 'info');
      });
      
      // Confetti button
      dom.confettiBtn.addEventListener('click', () => {
        showConfetti(80);
      });
      
      // Fireworks button
      dom.fwBtn.addEventListener('click', () => {
        launchFireworks(3);
      });
      
      // Love button
      dom.loveBtn.addEventListener('click', () => {
        showToast('Love Sent!', `Hearts and hugs sent to ${CONFIG.birthdayName}! üíñ`, 'success');
        updateCelebrationCount(1);
        
        // Add heart animation
        const heart = document.createElement('div');
        heart.innerHTML = '‚ù§Ô∏è';
        heart.style.position = 'fixed';
        heart.style.fontSize = '35px';
        heart.style.zIndex = '100';
        heart.style.left = '50%';
        heart.style.top = '50%';
        heart.style.transform = 'translate(-50%, -50%)';
        heart.style.opacity = '0';
        heart.style.transition = 'all 1s ease';
        heart.style.textShadow = '0 5px 15px rgba(255, 122, 196, 0.5)';
        
        document.body.appendChild(heart);
        
        setTimeout(() => {
          heart.style.opacity = '1';
          heart.style.transform = 'translate(-50%, -100%)';
        }, 10);
        
        setTimeout(() => {
          heart.style.opacity = '0';
          heart.style.transform = 'translate(-50%, -150%)';
          setTimeout(() => heart.remove(), 1000);
        }, 1000);
      });
      
      // Lightbox close
      dom.lightboxClose.addEventListener('click', closeLightbox);
      dom.lightbox.addEventListener('click', (e) => {
        if (e.target === dom.lightbox) closeLightbox();
      });
      
      // Toast close
      dom.toastClose.addEventListener('click', () => {
        dom.toast.classList.remove('show');
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Escape closes lightbox
        if (e.key === 'Escape' && dom.lightbox.classList.contains('visible')) {
          closeLightbox();
        }
        
        // Space toggles music when focused on music button
        if (e.key === ' ' && document.activeElement === dom.musicBtn) {
          e.preventDefault();
          dom.musicBtn.click();
        }
        
        // V toggles video
        if (e.key === 'v' || e.key === 'V') {
          toggleVideoBackground();
        }
      });
      
      // Parallax effect for hero polaroid
      const heroArea = document.querySelector('.hero-section');
      const heroPolaroid = document.getElementById('heroPolaroid');
      
      heroArea.addEventListener('mousemove', (e) => {
        const rect = heroArea.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const rotateX = (y - centerY) / 25;
        const rotateY = (centerX - x) / 25;
        
        heroPolaroid.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(20px)`;
      });
      
      heroArea.addEventListener('mouseleave', () => {
        heroPolaroid.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateZ(0)';
      });
      
      // Click fireworks on canvas
      fireworksCanvas.addEventListener('click', (e) => {
        const rect = fireworksCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        createFirework(x, y);
      });
      
      // Avatar click
      dom.avatarPolaroid.addEventListener('click', () => {
        showToast('Birthday Star!', `Celebrating ${CONFIG.birthdayName} today! ‚ú®`, 'info');
        createFirework(dom.avatarPolaroid.offsetLeft + 75, dom.avatarPolaroid.offsetTop + 75, '#ffd86f');
      });
      
      // Handle video errors
      dom.bgVideo.addEventListener('error', () => {
        console.log("Video error occurred");
        showToast('Video Error', 'Could not load background video. Using fallback background.', 'error');
        document.querySelector('.video-background').style.display = 'none';
      });
    }

    // ========== START EVERYTHING ==========
    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', init);
    
    // Fallback in case DOMContentLoaded already fired
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      setTimeout(init, 100);
    }
  </script>
</body>
</html>